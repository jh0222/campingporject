<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fi.pj.board.BoardMapper">
	<select id="getAllfreeboard" resultType="com.fi.pj.board.Freeboard" parameterType="com.fi.pj.board.Page">
		select rn,f_no,f_u_id,f_subject,f_readcount,f_date
		from (select Rownum as rn,f_no,f_u_id,f_subject,f_readcount,f_date
		from (select f_no,f_u_id,f_subject,f_readcount,f_date
		from free_board_table
		order by f_no desc))
		where RN &gt;=#{from} and RN &lt;=#{to}
	</select> 
	
	<select id="FbSearch_subject" resultType="com.fi.pj.board.Freeboard" parameterType="com.fi.pj.board.Search">
		select rn,f_no,f_u_id,f_subject,f_readcount,f_date
		from (select Rownum as rn,f_no,f_u_id,f_subject,f_readcount,f_date
		from (select f_no,f_u_id,f_subject,f_readcount,f_date
		from free_board_table 
		where f_subject like '%'||#{search}||'%' 
		order by f_no desc))
		where RN &gt;=#{from} and RN &lt;=#{to}
	</select>
	
	<select id="FbSearch_subject_cnt" resultType="Integer" parameterType="com.fi.pj.board.Search">
		select count(*) from free_board_table where f_subject like '%'||#{search}||'%' order by f_no desc 
	</select>
	
	<select id="FbSearch_id" resultType="com.fi.pj.board.Freeboard" parameterType="com.fi.pj.board.Search">
		select rn,f_no,f_u_id,f_subject,f_readcount,f_date
		from (select Rownum as rn,f_no,f_u_id,f_subject,f_readcount,f_date
		from (select f_no,f_u_id,f_subject,f_readcount,f_date
		from free_board_table 
		where f_u_id like '%'||#{search}||'%' 
		order by f_no desc))
		where RN &gt;=#{from} and RN &lt;=#{to}
	</select>
	
	<select id="FbSearch_id_cnt" resultType="Integer" parameterType="com.fi.pj.board.Search">
		select count(*) from free_board_table where f_u_id like '%'||#{search}||'%' order by f_no desc 
	</select>
	
	<select id="getonefreeboard" resultType="com.fi.pj.board.Freeboard" parameterType="com.fi.pj.board.Freeboard">
		select * from free_board_table where f_no=#{f_no}
	</select>
	
	<insert id="FbInsert" parameterType="com.fi.pj.board.Freeboard">
		insert into free_board_table values(free_board_seq.nextval,#{f_u_id},#{f_subject},#{f_txt},0,sysdate)
	</insert> 
	
	<update id="FbUpdate" parameterType="com.fi.pj.board.Freeboard">
		update free_board_table set f_subject=#{f_subject},f_txt=#{f_txt}
		where f_no = #{f_no}
	</update>
	
	<delete id="FbDelete" parameterType="com.fi.pj.board.Freeboard">
		delete from free_board_table where f_no = #{f_no}
	</delete>

	<insert id="FbreplyInsert2" parameterType="com.fi.pj.board.FbReply">
		insert into free_board_reply_table
		values(free_board_reply_seq.nextval,#{fr_f_no},#{fr_u_id},#{fr_owner_no},#{fr_owner_id},#{fr_replytxt},sysdate,#{fr_depth},#{fr_picture})
	</insert>
	
	<insert id="FbreplyInsert" parameterType="com.fi.pj.board.FbReply">
		insert into free_board_reply_table
		values(free_board_reply_seq.nextval,#{fr_f_no},#{fr_u_id},null,null,#{fr_replytxt},sysdate,#{fr_depth},#{fr_picture})
	</insert>
	
	<select id="getfbreply" resultType="com.fi.pj.board.FbReply" parameterType="com.fi.pj.board.Page">
		select rn,fr_no,fr_f_no,fr_u_id,fr_owner_no,fr_owner_id,fr_replytxt,fr_date,fr_depth,fr_picture
		from (select Rownum as rn,fr_no,fr_f_no,fr_u_id,fr_owner_no,fr_owner_id,fr_replytxt,fr_date,fr_depth,fr_picture
		from (select * from free_board_reply_table 
		where fr_f_no=#{f_no} and fr_owner_no is null 
		order by fr_no desc))
		where RN &gt;=#{from} and RN &lt;=#{to}		
	</select>
	
	<delete id="FrDelete" parameterType="com.fi.pj.board.FbReply">
		delete from free_board_reply_table where fr_no = #{fr_no}
	</delete>
	
	<delete id="Fr3Delete" parameterType="com.fi.pj.board.FbReply">
		delete from free_board_reply_table where fr_no = #{fr_owner_no}
	</delete>
	
	<update id="FrDelete_update" parameterType="com.fi.pj.board.FbReply">
		update free_board_reply_table set fr_u_id='(알수없음)',fr_picture='x',fr_replytxt='삭제된 댓글입니다'
		where fr_no = #{fr_no}
	</update>
	
	<select id="FrDelete_update_select" parameterType="com.fi.pj.board.FbReply"  resultType="Integer">
		select count(*)	from free_board_reply_table where fr_owner_no=#{fr_no}
	</select>
	
	<select id="FrDelete_3_select" resultType="Integer" parameterType="com.fi.pj.board.FbReply">
		select count(*) from free_board_reply_table where fr_u_id='(알수없음)' and fr_no=#{fr_owner_no}
	</select>
	
	<select id="FrDelete_r_select" resultType="Integer" parameterType="com.fi.pj.board.FbReply" >
		select count(*) from free_board_reply_table where fr_owner_no=#{fr_owner_no}
	</select>
	
	<select id="getfbrreply" resultType="com.fi.pj.board.FbReply" parameterType="com.fi.pj.board.Freeboard">
		select * from free_board_reply_table where fr_f_no=#{f_no} and fr_owner_no is not null order by fr_no asc
	</select>
	
	<update id="Fbcount_update" parameterType="com.fi.pj.board.Freeboard">
		update free_board_table set f_readcount=#{f_readcount } + 1
		where f_no = #{f_no}
	</update>
	
	<select id="getAllfreeboardcnt" resultType="Integer" >
		select count(*) from free_board_table
	</select>
	
	<select id="getAllfreeboardreplycnt" resultType="Integer" parameterType="com.fi.pj.board.Freeboard">
		select count(*) from free_board_reply_table where fr_f_no=#{f_no} and fr_owner_no is null
	</select>
	
	<update id="Fr_update" parameterType="com.fi.pj.board.FbReply">
		update free_board_reply_table set fr_replytxt=#{fr_replytxt}
		where fr_no = #{fr_no}
	</update>
</mapper>